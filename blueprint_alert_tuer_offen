blueprint:
  name: T√ºr Alarm mit Kamera Snapshot (Critical iPhone)
  description: Sendet eine Critical Push-Nachricht mit Kamera Snapshot, wenn eine T√ºr ge√∂ffnet wird. Aktivierbar per input_boolean.
  domain: automation
  input:
    door_sensor:
      name: T√ºrsensor
      selector:
        entity:
          domain: binary_sensor
          device_class: door

    camera_entity:
      name: Kamera
      description: Kamera f√ºr Snapshot
      selector:
        entity:
          domain: camera

    notify_device:
      name: iPhone Ger√§t
      selector:
        device:
          integration: mobile_app

    enable_toggle:
      name: Alarm Ein/Aus Schalter
      selector:
        entity:
          domain: input_boolean

trigger:
  - platform: state
    entity_id: !input door_sensor
    from: "off"
    to: "on"

condition:
  - condition: state
    entity_id: !input enable_toggle
    state: "on"

variables:
  snapshot_file: "/config/www/tuer_snapshot.jpg"

action:
  - service: camera.snapshot
    target:
      entity_id: !input camera_entity
    data:
      filename: "{{ snapshot_file }}"

  - delay: "00:00:01"

  - device_id: !input notify_device
    domain: mobile_app
    type: notify
    title: "üö® T√úR ALARM!"
    message: "Die T√ºr wurde ge√∂ffnet!"
    data:
      image: "/local/tuer_snapshot.jpg"
      push:
        sound:
          name: default
          critical: 1
          volume: 1.0

mode: single